function getDocHeight(){footerheight||(footerheight=$("footer").height());var t=document;return Math.max(t.body.scrollHeight,t.documentElement.scrollHeight,t.body.offsetHeight,t.documentElement.offsetHeight,t.body.clientHeight,t.documentElement.clientHeight)-footerheight}function didHitBottom(t){return(t=t||0)+$(window).scrollTop()+$(window).height()>=getDocHeight()}function setUrlParam(t,n,i){var e=window.location.href;e=e.split("#",2);var o="";e[1]&&(o="#"+e[1]),e=e[0];var a=e.split("?",2);for(var r in t)if(val=encodeURIComponent(t[r]),a[1]&&a[1].length>1)if(-1==e.search(r+"=")){var s="&";a[1].length<2&&(s=""),e+=s+r+"="+val,a=e.split("?",2)}else{for(var l=a[1].split("&"),f=0;f<l.length;f++){var c=l[f].trim();if(0==c.indexOf(r+"=")){l[f]=r+"="+val;break}}a[1]=l.join("&"),e=a[0]+"?"+a[1]}else-1!=e.indexOf("?")?e+="&"+r+"="+val:e+="?"+r+"="+val;if(n){for(var l=a[1].split("&"),d=[],f=0;f<l.length;f++){keep=!0;for(var u=0;u<n.length;u++)if(0==l[f].indexOf(n[u])){keep=!1;break}keep&&d.push(l[f])}e=a[0]+"?"+d.join("&")}return e+(!1===i?"":o)}function DropDown(t){this.dd=t,this.initEvents()}$(function(){var t=!0,n=$("#albumWrapper");if(!n.length)return!1;$.extend($.expr[":"],{inview:function(t){var n=$(t),i=$(arguments[1]),e=i.scrollLeft(),o=n.position().left-1+e,a=e+i.width();return o>e&&o<a},outview:function(t){var n=$(t),i=$(arguments[1]),e=i.scrollLeft(),o=n.position().left+e+n.width(),a=e+i.width();return o>e&&o<a},containedview:function(t){var n=$(t),i=$(arguments[1]),e=i.scrollLeft(),o=n.position().left+e,a=e+i.width();return n.data("focusfactor",Math.min(o+n.width(),a)-Math.max(o,e)),o>=e&&o<=a||o+n.width()>=e&&o+n.width()<=a},notcontainedenough:function(t){var n=$(t),i=$(arguments[1]),e=i.scrollLeft(),o=n.position().left+e,a=e+i.width();return!(o>=e&&o<=a&&o+n.width()>=e&&o+n.width()<=a)}}),$.fn.focusNext=function(t){if($(this)){var n=$(this).find(".fileitem:"+(t?"outview:first":"inview:last"));if(n&&n.length)n.focusImage($(this),200),$(this).data("lastfocus",n);else{if((n=$(this).find(".fileitem:containedview:first"))&&n.length&&(n=t?n.prev():n.next())&&n.length)return void n.focusImage($(this),200);$(this).animate({scrollLeft:t?0:$(this).prop("scrollWidth")-$(this).width()},200)}}},$.fn.focusImage=function(t,n){if($(this)){var i=parseInt(t.scrollLeft()),e=$(this).position().left+i-t.width()/2+$(this).width()/2;t.animate({scrollLeft:e},n)}};var i=2;$(window).scroll(function(){didHitBottom()&&t&&(t=!1,$.ajax({type:"GET",url:"./albums?page="+i,success:function(e){if(e){var o=$(e);n.append(o);o.find(".pag-scroller").bindScroller(),i++,t=!0,$(window).trigger("scroll")}else t=!1}}))}),$(".fs-album-wrapper").on("click",".pag-col",function(t){var n=$(this).parent(),i=n.find(".pag-scroller:first"),e=$(this).hasClass("lefter");i.focusNext(e)}),$.fn.bindScroller=function(){var t=$(this);$(this).on("scroll",function(n){var i=t.data("timer");clearTimeout(i),$alls=t.find(".fileitem"),t.data("focused")&&($alls.stop().fadeTo(0,1),t.data("focused",!1)),isBreakPoint(480)?t.data("timer",setTimeout(function(){var n=t.find(".fileitem:containedview");if(n&&n.length){var i=null;n.each(function(t){(!i||$(this).data("focusfactor")&&$(this).data("focusfactor")>i.data("focusfactor"))&&(i=$(this))}),i&&i.focusImage(t,200)}},150)):t.data("timer",setTimeout(function(){var n=t.find(".fileitem:notcontainedenough");n.length!=$alls.length&&(t.data("focused",!0),n.stop().fadeTo(500,.12))},1500))}),$(this).unveil(400)},$(".pag-scroller").bindScroller(),$(window).trigger("scroll")});var footerheight,isBreakPoint=function(t){for(var n,i,e=[320,480,768,1024],o=$(window).width(),a=0,r=e.length;a<r;a++)if(e[a]===t){n=e[a-1]||0,i=e[a];break}return o>n&&o<=i};DropDown.prototype={initEvents:function(){this.dd.on("click",function(t){$(this).toggleClass("active"),t.stopPropagation()})}},$(function(){new DropDown($(".wrapper-dropdown"));$(document).click(function(){$(".wrapper-dropdown").removeClass("active")})}),$(function(){var t=0,n=[],i=$("#fsWrapper .content"),e=i.find("> .fspolar img");if($.fn.findOutPoint=function(){var t=$(this).outerWidth(),n=$(this).outerHeight(),i=Math.floor(100*Math.random())+1;return Date.now()%2==0&&(i*=-1),{x:i+"%",y:-100-t/n*30-30+"%"}},$.fn.findInPoint=function(){var t=$(this).outerWidth(),n=t/i.outerWidth(),e=Math.floor(Math.random()*(1/n)*50*.75)+1,o=Math.floor(Math.random()*Math.abs(100-1/.75*100))+1;return Date.now()%2==0&&(e*=-1),{x:e+"%",y:o+"%"}},$.fn.nextTransform=function(){var t,n=" rotate("+30*Math.random()*(Date.now()%2?1:-1)+"deg)";return $(this).data("out")?(t=$(this).findInPoint(),n="",$(this).data("out",!1)):(t=$(this).findOutPoint(),$(this).data("out",!0)),"translate("+t.x+", "+t.y+")"+n},$.fn.fly=function(t){return this.each(function(){var n=$(this).nextTransform(),i=t?"none":"transform 2s";$(this).css({transition:i,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n,"-o-transform":n,transform:n,display:"block"})})},e.fly(!0),e.length){var o,a=0;!function i(){var r=!1,s=0;do{t>e.length-1&&(t=0);var l=e.get(t);if(l.complete&&(r=$(l)),s++>=e.length)break;t++}while(!r);if(r){r.css({"z-index":++a,filter:"none"}),r.fly();if(n.length>=3){var f=n.shift();f&&f.fly()}n.push(r)}o=setTimeout(i,3e3)}()}}),function(t){t.fn.unveil=function(n,i){function e(){var n=f.filter(function(){var n=t(this),i=a.scrollLeft(),e=i+a.width(),o=n.position().left+i;return o+n.width()>=i-r&&o<=e+r});o=n.trigger("unveil"),f=f.not(o)}var o,a=t(this),r=n||0,s=window.devicePixelRatio>1,l=s?"data-src-retina":"data-src",f=t(this).find(".fileitem");return f.one("unveil",function(){var t=this,n=this.children[0],e=n.getAttribute(l);(e=e||n.getAttribute("data-src"))&&(n.setAttribute("src",e),n.onload=function(){t.removeChild(t.children[1])},"function"==typeof i&&i.call(n))}),a.on("scroll.unveil resize.unveil lookup.unveil",e),e(),this},t.fn.hitsBottom=function(n,i){var e=t(this);i=i||0,t(window).on("scroll resize",function(t){didHitBottom(i)&&("function"==typeof n&&n.call(window,i),e.trigger("bottomhit"))})}}(window.jQuery||window.Zepto),$(function(){var t=$("#aw_navbar .navbar-links"),n=$("a",t);n.hover(function(t){n.not(this).addClass("blur")},function(t){n.removeClass("blur")})}),$(function(){function t(){return!!f&&(f=!1,$.ajax({type:"GET",url:setUrlParam({by:a.data("selectedsort"),seed:a.data("seed"),page:l}),success:function(t){n(t)?(l++,f=!0,$(window).trigger("scroll")):f=!1}}))}function n(t){if(t&&t.length){for(var n=0;n<t.length;n++){for(var i=0;i<r.length;i++){var e=$(r[i]);(!c||parseInt(e.data("height"))<parseInt(c.data("height")))&&(c=e)}var o=$(t[n]),l=c.index();o.data("index",s++),o.data("col",l),h[l].push(o),d.push(o);var f={src:o.data("path"),w:o.data("lwidth"),h:o.data("lheight")};u.push(f);var p=parseInt(o.data("height"));c.data("height",parseInt(c.data("height"))+p),x?$(r[0]).append(o):c.append(o)}return!0}return d.length||a.find(".noresults:first").show(),!1}function i(n){var i={index:n,loop:!1,bgOpacity:1,timeToIdle:3e3,history:!0,barsSize:{top:0,bottom:0}};b=new PhotoSwipe(document.getElementById("pswp"),PhotoSwipeUI_Default,u,i),$nextBtn=$(".pswp__button--arrow--right",b.template),$prevBtn=$(".pswp__button--arrow--left",b.template),b.listen("beforeChange",function(){this.getCurrentIndex()==this.items.length-1&&f?(console.log("fetching page "+l),$nextBtn.hide(),t().done(function(){b.invalidateCurrItems(),b.updateSize(!0),f&&$nextBtn.show()})):f||$nextBtn.toggle(this.getCurrentIndex()<this.items.length-1),$prevBtn.toggle(this.getCurrentIndex()>0)}),b.listen("afterChange",function(){var t=b.getCurrentIndex();if(d[t]){var n=d[t].find(".albumname:first");v.text(n.text().trim()),m.off().on("click",function(t){return t.stopPropagation(),document.location=setUrlParam({album:n.data("album")},!1,!1),!1});var i=d[t].find(".infowrapper:first").clone();i.addClass("info-viewer"),i.css({display:"block"}),w.html(i)}}),b.listen("destroy",function(){b=null}),b.init(),d[n]&&o(d[n].hasClass("infoup")?"show":"hide",0)}function e(){x?$(r[0]).append(d):r.each(function(t){$(this).append(h[t])})}function o(t,n){void 0===n&&(n=100);var i=function(){g.toggleClass("freeze",w.is(":visible")),g.find(".pswp__button--info:first").toggleClass("active",w.is(":visible"))};b&&("show"==t?w.fadeIn(n,"swing",i):"hide"==t?w.fadeOut(n,"swing",i):w.fadeToggle(n,"swing",i))}var a=$("#photosWrapper");if(!a.length)return!1;var r=$(".photo-col"),s=0,l=1,f=!0,c=null,d=[],u=[],h={};r.each(function(t){h[t]=[]}),a.hitsBottom(function(n){t()},400);var p=t();p&&p.done(function(){t()});var g=$("#pswp"),v=g.find(".viewer-album:first"),m=g.find(".pswp__button--album:first"),w=g.find(".pswp__info:first"),b=null,x=isBreakPoint(768);$(window).on("resize",function(t){$(window).width()<753&&!x?(x=!0,e()):$(window).width()>=753&&x&&(x=!1,e())}),e(),$.fn.infoup=function(){var t=$(this),n=t.find(".infowrapper:first"),i=t.find("img:first");t.hasClass("infoup")?(n.fadeOut(100),i.removeClass("blurimg"),t.removeClass("infoup")):(n.fadeIn(100),i.addClass("blurimg"),t.addClass("infoup"))},g.on("click",".pswp__button--download",function(t){if(b){var n=b.getCurrentIndex();if(d[n]){var i=d[n].find(".toggle-download:first").attr("href");if(i)return void(document.location=i)}}alert("Could not download image")}),g.on("click",".pswp__button--info",function(t){o("toggle")}),w.on("click",function(t){o("hide")}),a.on("click",".albumname",function(t){t.stopPropagation();var n=parseInt($(this).data("album"));document.location=setUrlParam({album:n})}),a.on("click",".thumb, .toggle-zoom",function(t){t.stopPropagation(),i($(this).parents(".imgwrapper:first").data("index"))}),a.on("click",".toggle-info",function(t){t.stopPropagation(),$(this).parents(".imgwrapper:first").infoup()}),a.on("click",".infowrapper",function(t){t.stopPropagation(),$(this).parents(".imgwrapper:first").infoup()}),$("#droper").on("click",".sort-select",function(t){t.stopPropagation();var n=parseInt($(this).data("sort"));document.location=setUrlParam({by:n})})}),$(function(){function t(){var t=$("#imagecells > div.imagecell");if(t.length){var n=$(t[0]).data("token"),i={};t.each(function(t){i[parseInt($(this).data("file"))]=t+1}),$.post($("body").data("path")+"/aupload/fsaveorder",{order:i,_token:n},function(t){console.log(t)})}}var n=$("#upload_wrapper");if(!n.length)return!1;const i=new Clarifai.App({apiKey:"ea746f008b50445aa47ffb018f3d5681"});$("#albumchoice").on("change",function(t){document.location=$("body").data("path")+"/aupload/"+$(this).val()});var e=null;$("#upload_wrapper").on("focus",".tags-text",function(t){e=$(this).val()}),$("#upload_wrapper").on("blur",".tags-text",function(t){$(this).val()!=e&&$(this).save()}),$("#upload_wrapper").on("click",".save-tags",function(t){$(this).save()}),$("#upload_wrapper").on("click",".auto-tags",function(t){$(this).autoTag()}),n.find("#imagecells:first").sortable({stop:function(n,i){t()}}),$.fn.autoTag=function(){var t=$(this),n=t.parents(".imagecell:first"),e=n.data("name"),o=n.find(".tags-text:first"),a=o.val();a=a?a.split(","):[];var r=$("body").data("path")+"/img/large/"+e;i.models.predict(Clarifai.GENERAL_MODEL,r).then(function(n){for(var i=0;i<n.outputs.length;i++)for(var e=n.outputs[i].data.concepts,r=0;r<e.length;r++){var s=e[r].name,l=e[r].value;l>.93&&-1==s.indexOf(",")&&-1==$.inArray(s.trim(),a)&&a.push(s)}var f=a.join(",");o.val(f),t.save()},function(t){console.log(t)})},$.fn.save=function(){var t=$(this).parents(".imagecell:first"),n=t.find(".tags-text:first").val(),i=t.data("file"),e=t.data("token");$.post($("body").data("path")+"/aupload/fsave/"+parseInt(i),{file:i,tags:n,_token:e},function(t){console.log(t)})}});